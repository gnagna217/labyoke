extends layout

block content
	if !doing
		div(id="pageloader")
			div(class="spinner")
				div(class="bounce1")
				div(class="bounce2")
				div(class="bounce3")
	//- var shadow = ""
	- var nobar = ""
	- var fadesections = ""
	- var hidefadesections = ""
	- var uploadtext = ""
	- var slide = "moveFromLeft"
	- if(doing == "upload")
		- slide = ""
		//- var nobar = "display:none;"
		//- shadow = "uploadh"
		- fadesections = "fadesections"
		- hidefadesections = "hidefadesections"
		- uploadtext = "uploadtext"

	- var adjust = "adjustpadding"
	- var filteroutput2 = report_sharesbycategory.filter(function(x){console.log("filter2: " + x.insuff); return (x.insuff == 1)});
	div(id="langText", style="display:none")!= lang
	div(id="ios-light")
		center
			h1= i18n.__("admins.pop.title")
			p(id="orderText")
			div!= i18n.__("admins.pop.subtitle")
	div(class="shade" id="shade")
	div(class="shade-light" id="shade-light")
	div(class="container login marginbottom margintop container2 " + slide)
		div
			a(name="upload")
		div(class="share-container2 adjustpaddingrightandwidth2", style="float:left;")
			h1= i18n.__("admins.title")
			if(isLoggedInAdmin > 0)
				//div(class="threepointsmobile", style=nobar)
				- if(doing == "upload")
					div(class="threepointsmobile", style=nobar)
				h3(style="", class=uploadtext)= i18n.__("shares.admin.title")
				p= i18n.__("shares.admin.subtitle")
				form(id="uploadForm", enctype="multipart/form-data", action="share", method="post")
					input(style="display:none", type="file" name="file",id="file", class="inputfile inputfile-1", data-multiple-caption="{count} files selected")
					label.shadow(for="file", style="width: 50%;text-align: center;border-radius: 6px;")
						svg(xmlns="http://www.w3.org/2000/svg", width="20", height="17", viewBox="0 0 20 17")
							path(d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z")
						span= i18n.__("shares.admin.file")
					div(class="buttons")
						button.btn.btn-success.btn-lg.btn-block.shadow(type="submit",value="Upload",name="submit")= i18n.__("shares.admin.button")
						//img(src="/images/yoke5.png", class=hidefadesections + " noshowmobile767", alt="The Lab", title="Lab", style="border-width:0px; width: 35px; margin-top: -67px; margin-left: 300px;")
			if(nosuccess == "databaserror")
				div
					div(id="uploaderror", class="table-responsive alert alert-danger alertshadow")
						span(style="text-align: center")
							h3(style="padding-bottom: 20px;")= i18n.__("shares.admin.error1")
				script="$(window).scrollTop($('#uploadForm').offset().top).scrollLeft($('#uploadForm').offset().left);"
			if(nosuccess == "nofile")
				div
					div(id="uploaderror", class="table-responsive alert alert-danger alertshadow")
						span(style="text-align: center")
							h3(style="padding-bottom: 20px;")= i18n.__("shares.admin.error2")
				script="$(window).scrollTop($('#uploadForm').offset().top).scrollLeft($('#uploadForm').offset().left);"
			if(nosuccess == "nodata")
				div
					div(id="uploaderror", class="table-responsive alert alert-danger alertshadow")
						span(style="text-align: center")
							h3(style="padding-bottom: 20px;")= i18n.__("shares.admin.error3")
								span(style="color: #3d9dcb;")=" " + spreadname
				script="$(window).scrollTop($('#uploadForm').offset().top).scrollLeft($('#uploadForm').offset().left);"
			if(nosuccess == "generic")
				div
					div(id="uploaderror", class="table-responsive alert alert-danger alertshadow")
						span(style="text-align: center")
							h3(style="padding-bottom: 20px;")= i18n.__("shares.admin.error4")
				script="$(window).scrollTop($('#uploadForm').offset().top).scrollLeft($('#uploadForm').offset().left);"
			if json
				div(id="results")
					div(id="ctl00_Div2" class="row rank")
						div(class="table-responsive")
							span(style="text-align: center")
								h3(style="padding-bottom: 20px;")= i18n.__("shares.admin.success")
									span(style="color: #3d9dcb;")=" " + spreadname                   
							table(id="rankTblload" class="table rankTbl")
								thead
									tr(class="you info-best" style="font-weight: bold")
										td(class="desktabonly")= 'id '
										td(class="wrapped")!= 'Reagent'
										td= 'Vendor'
										td= 'Catalog'
										td= 'Location'
								tbody
									-var ob = json
									-for(var prop in ob)
										tr(class="")
											td(class="desktabonly") #{prop}
											td(class="wrapped") #{ob[prop].name_of_reagent}
											td #{ob[prop].vendor}
											td #{ob[prop].catalog_number}
											td #{ob[prop].location}
							script.
								$(document).ready(function() {
									$('#rankTblload').DataTable({
										language:{
										processing: "#{i18n.__("datatable.processing")}",
										search: "#{i18n.__("datatable.search")}",
										lengthMenu: "#{i18n.__("datatable.lengthMenu")}",
										info: "#{i18n.__("datatable.info")}",
										infoEmpty: "#{i18n.__("datatable.infoEmpty")}",
										infoFiltered: "#{i18n.__("datatable.infoFiltered")}",
										infoPostFix: "",
										loadingRecords: "#{i18n.__("datatable.loadingRecords")}",
										zeroRecords: "#{i18n.__("datatable.zeroRecords")}",
										emptyTable: "#{i18n.__("datatable.emptyTable")}",
										paginate: {
										first: "#{i18n.__("datatable.first")}",
										previous: "#{i18n.__("datatable.previous")}",
										next: "#{i18n.__("datatable.next")}",
										last: "#{i18n.__("datatable.last")}",
										//search: "_INPUT_",
										searchPlaceholder: "#{i18n.__("datatable.searchplaceholder")}"
										},
										aria: {
										sortAscending: "#{i18n.__("datatable.sortAscending")}",
										sortDescending: "#{i18n.__("datatable.sortDescending")}"
										}
									}
										});
								});
				script="$(window).scrollTop($('#uploadForm').offset().top).scrollLeft($('#uploadForm').offset().left);"
			div(style=nobar, class="threepointssep")
			- if(doing == "upload")
					div(class="threepointsmobile", style=nobar)

		div(style="float: right;" class="share-container2 " + fadesections)
			if(myshares == "")
				//- adjust = ""
				h3= i18n.__("admins.subtitle")
			if(mysharesrequest != null && mysharesrequest.length>0)
				- var output = mysharesrequest.filter(function(x){return x.status=="new"});
				h3= i18n.__("admins.subtitle1")
				p
					- var requestIntro = output.length + i18n.__("admins.intro5")
					- if(output.length == 0)
						- requestIntro = i18n.__("admins.intro")
					span(class="labColor")!= requestIntro
					span= i18n.__("admins.intro1")
					- var totalrequestIntro = "<span class='labColor'>" + mysharesrequest.length + i18n.__("admins.intro2") + "</span>"
					- if(mysharesrequest.length == 0)
						- totalrequestIntro = i18n.__("admins.intro3")
					span!= totalrequestIntro + i18n.__("admins.intro4")
				div(id="results2", class="resultsshadow")
					div(id="ctl00_Div2" class="row rank")
						div(class="table-responsive")               
							table(id="rankTblreqshares" class="table rankTbl")
								thead
									tr(class="you info-best" style="font-weight: bold")
										th(class="wrapped")!= i18n.__("shares.table.reagent")
										th(class="")= i18n.__("shares.table.vendor")
										th(class="")= i18n.__("shares.table.catalog")
										th(class="")= i18n.__("shares.table.requestor")
										th= i18n.__("shares.table.date")
										th= i18n.__("shares.table.delete")
										th= i18n.__("shares.table.fulfill")
								tbody
									-var ob = mysharesrequest
									-for(var prop in ob)
										- var n = ob[prop].status
										- var d = new Date(ob[prop].date)
										- d = d.toLocaleDateString("en-US")
										- var isnew = ""
										- var checkedstr = false
										- var checkedfilledstr = false
										- if(n == "new")
											- isnew = "isnew"
										- var insuff = parseInt(ob[prop].insufficient)
										- if(insuff == 0)
											- isnew = "yokeBackColor"
											- checkedstr = true
										- var status = parseInt(ob[prop].status)
										- if(status == 'fulfilled')
											- checkedfilledstr = true
										- var lab = (ob[prop].lab).replace(" ","").toLowerCase();
										tr(class=isnew)
											td(class="wrapped") #{ob[prop].agent}
											td(class="") #{ob[prop].vendor}
											td(class="") #{ob[prop].catalognumber}
											td(class="") #{ob[prop].requestoremail}
											td #{d}
											td
												form(action="/cancelshare" method="post")
													input(type="checkbox" name="cancel" value="cancel" class="cancel" checked=(checkedstr===true ? "checked" : undefined))
													input(type="hidden" name="agent" value=ob[prop].agent)
													input(type="hidden" name="lab" value=ob[prop].lab)
													input(type="hidden" name="vendor" value=ob[prop].vendor)
													input(type="hidden" name="catalognumber" value=ob[prop].catalognumber)
													input(type="hidden" name="email" value=ob[prop].email)
													input(type="hidden" name="requestoremail" value=ob[prop].requestoremail)
													input(type="hidden" name="date" value=ob[prop].date)
													input(type="hidden" name="table" value=currentlabname.replace(" ","").toLowerCase() + "_orders")
											td
												form(action="/fulfillshare" method="post")
													input(type="checkbox" name="fulfill" value="fulfill" class="fulfill" checked=(checkedfilledstr===true ? "checked" : undefined))
													input(type="hidden" name="agent" value=ob[prop].agent)
													input(type="hidden" name="lab" value=ob[prop].lab)
													input(type="hidden" name="owneremail" value=ob[prop].email)
													input(type="hidden" name="vendor" value=ob[prop].vendor)
													input(type="hidden" name="catalognumber" value=ob[prop].catalognumber)
													input(type="hidden" name="email" value=ob[prop].email)
													input(type="hidden" name="requestoremail" value=ob[prop].requestoremail)
													input(type="hidden" name="date" value=ob[prop].date)
													input(type="hidden" name="table" value=currentlabname.replace(" ","").toLowerCase() + "_orders")
							script.
								$(document).ready(function() {
									$('#rankTblreqshares').DataTable({order: [[ 4, "desc" ]],
										
									language:{
										processing: "#{i18n.__("datatable.processing")}",
										search: "#{i18n.__("datatable.search")}",
										lengthMenu: "#{i18n.__("datatable.lengthMenu")}",
										info: "#{i18n.__("datatable.info")}",
										infoEmpty: "#{i18n.__("datatable.infoEmpty")}",
										infoFiltered: "#{i18n.__("datatable.infoFiltered")}",
										infoPostFix: "",
										loadingRecords: "#{i18n.__("datatable.loadingRecords")}",
										zeroRecords: "#{i18n.__("datatable.zeroRecords")}",
										emptyTable: "#{i18n.__("datatable.emptyTable")}",
										paginate: {
										first: "#{i18n.__("datatable.first")}",
										previous: "#{i18n.__("datatable.previous")}",
										next: "#{i18n.__("datatable.next")}",
										last: "#{i18n.__("datatable.last")}",
										//search: "_INPUT_",
										searchPlaceholder: "#{i18n.__("datatable.searchplaceholder")}"
										},
										aria: {
										sortAscending: "#{i18n.__("datatable.sortAscending")}",
										sortDescending: "#{i18n.__("datatable.sortDescending")}"
										}
									}
									});
								});
				div(class="threepointssep")
			if(myshares != "")
				h3= i18n.__("admins.none.title")
				p!= i18n.__("admins.none.subtitle")
				div(id="results2", class="resultsshadow")
					div(id="ctl00_Div2" class="row rank")
						div(class="table-responsive")               
							table(id="rankTblshares" class="table rankTbl")
								thead
									tr(class="you info-best" style="font-weight: bold")
										th(class="wrapped")!= i18n.__("shares.table.reagent")
										th= i18n.__("shares.table.location")
										th= i18n.__("shares.table.email")
										th= i18n.__("shares.table.vendor")
										th= i18n.__("shares.table.catalog")
										th= i18n.__("shares.table.delete")
								tbody
									-var ob = myshares
									-for(var prop in ob)
										- var currentqtyint = parseInt(ob[prop].currentquantity)
										- var qtyinsufficient = ""
										- var checkedstr = false
										- var insuff = parseInt(ob[prop].insufficient)
										- if(insuff == 0)
											- qtyinsufficient = "yokeBackColor"
											- checkedstr = true
										tr(class=qtyinsufficient)
											td(class="wrapped") #{ob[prop].agent}
											td #{ob[prop].location}
											td #{ob[prop].email}
											td #{ob[prop].vendor}
											td #{ob[prop].catalognumber}
											td
												form(action="/cancelshare" method="post")
													input(type="checkbox" name="cancel" value="cancel" class="cancel" checked=(checkedstr===true ? "checked" : undefined))
													input(type="hidden" name="agent" value=ob[prop].agent)
													input(type="hidden" name="vendor" value=ob[prop].vendor)
													input(type="hidden" name="lab" value=ob[prop].lab)
													input(type="hidden" name="catalognumber" value=ob[prop].catalognumber)
													input(type="hidden" name="email" value=ob[prop].email)
													input(type="hidden" name="date" value=ob[prop].date)
													input(type="hidden" name="table" value="vm2016_agentsshare")
							script.
								$(document).ready(function() {
									$('#rankTblshares').DataTable({
										language:{
										processing: "#{i18n.__("datatable.processing")}",
										search: "#{i18n.__("datatable.search")}",
										lengthMenu: "#{i18n.__("datatable.lengthMenu")}",
										info: "#{i18n.__("datatable.info")}",
										infoEmpty: "#{i18n.__("datatable.infoEmpty")}",
										infoFiltered: "#{i18n.__("datatable.infoFiltered")}",
										infoPostFix: "",
										loadingRecords: "#{i18n.__("datatable.loadingRecords")}",
										zeroRecords: "#{i18n.__("datatable.zeroRecords")}",
										emptyTable: "#{i18n.__("datatable.emptyTable")}",
										paginate: {
										first: "#{i18n.__("datatable.first")}",
										previous: "#{i18n.__("datatable.previous")}",
										next: "#{i18n.__("datatable.next")}",
										last: "#{i18n.__("datatable.last")}",
										//search: "_INPUT_",
										searchPlaceholder: "#{i18n.__("datatable.searchplaceholder")}"
										},
										aria: {
										sortAscending: "#{i18n.__("datatable.sortAscending")}",
										sortDescending: "#{i18n.__("datatable.sortDescending")}",
										}
									}
										});
								});
		

		div(class="slide-out-tip-div desktabonly", style="display:none;z-index:1;position: fixed;top: 25% !important;max-height:400px;")
			a(class="handle" href="last-transactions", title='#{i18n.__("search.tip.title")}', style="right: -60px;,left:-60px;top:25px;")!=Content
			div(style="padding: 4px;color:white;top: -45px;position: relative;")
				p(style="font-size: 12pt;")!= i18n.__("shares.tip.header")
				div(style="position: relative;float: right;width: 250px;font-size: 9pt;line-height: 1.3;border-radius: 4px;max-height:320px;overflow:auto;")
					span!= i18n.__("shares.tip.desc")
			script.
				$(function(){
				$('.slide-out-tip-div').tabSlideOut({
				imgPos: 115,
				tabHandle: '.handle',                              //class of the element that will be your tab
				pathToTabImage: '/images/bouee3.png',          //path to the image for the tab (optionaly can be set using css)
				imageHeight: '50px',                               //height of tab image
				imageWidth: '50px',                               //width of tab image    
				tabLocation: 'right',                               //side of screen where tab lives, top, right, bottom, or left
				speed: 300,                                        //speed of animation
				action: 'click',                                   //options: 'click' or 'hover', action to trigger animation
				topPos: '25% !important',                                   //position from the top
				fixedPosition: true                               //options: true makes it stick(fixed position) on scroll
				});
				});
		span(class="desktabonly", id="checkdisplay")
		script.
			$( document ).ready(function() {
				$( ".uploadtext" ).addClass( "animated fadeIn" );
				$('body').click(function() {
					// jQuery selector to get an element
					var query = $('#focusadmin');
					// check if element is Visible
					var isVisible = query.is(':visible');
					if (isVisible === true) {
						console.log("hide admin focus");
						query.hide();
					}
				});
			console.log( "share document loaded" );
				if ($("#checkdisplay").css("display") == "none" ){
					$('.slide-out-tip-div').hide();
				} else {
					$('.slide-out-tip-div').show();
				}
			});
extends layout

block content
	if !doing
	- var nobar = ""
	- var fadesections = ""
	- var hidefadesections = ""
	- var uploadtext = ""
	- var slide = "moveFromLeft"
	- if(doing == "upload")
		- slide = ""
		- fadesections = "fadesections"
		- hidefadesections = "hidefadesections"
		- uploadtext = "uploadtext"
	- var adjust = "adjustpadding"
	- var filteroutput2 = report_sharesbycategory.filter(function(x){console.log("filter2: " + x.insuff); return (x.insuff == 1)});
	div(id="langText", style="display:none")!= lang
	div(id="ios-light")
		center
			h1= i18n.__("shares.pop.title")
			p(id="orderText")
			div!= i18n.__("shares.pop.subtitle")
	div(class="shade" id="shade")
	div(class="shade-light" id="shade-light")
	div(class="zoomnow container login marginbottom margintop container2 botbottom " + slide)
		div(style="float: left;" class="share-container " + fadesections)
			h1
				span(class="fa fa-exchange lightyokecolor")
				span!= i18n.__("shares.title")
				span(class="fa fa-caret-right lightyokecolor animated fadeIn" style="font-size: 20pt;")
			if(myshares == "")
				h4= i18n.__("shares.non.title")
				p!= i18n.__("shares.non.subtitle")
				div(class="searchlogo", style="margin-top:50px")
					span(class="fa fa-cubes" style=" color: #3d9dcb; font-size: 120pt; ")
			if(mysharesrequest != null && mysharesrequest.length>0)
				- var output = mysharesrequest.filter(function(x){return x.status!="fulfilled" && x.insufficient!=0});
				h4= i18n.__("shares.subtitle1")
				p
					- var requestIntro = output.length + i18n.__("shares.intro5") + " <span class='isnewcolor fa fa-square'></span>"
					- if(output.length == 0)
						- requestIntro = i18n.__("shares.intro")
					span!= requestIntro
					span= i18n.__("shares.intro1")
					- var totalrequestIntro = mysharesrequest.length + i18n.__("shares.intro2")
					- if(mysharesrequest.length == 0)
						- totalrequestIntro = i18n.__("shares.intro3")
					span!= totalrequestIntro + i18n.__("shares.intro4")
				div(id="results2", class="resultsshadow")
					div(id="ctl00_Div2" class="row rank")
						div(class="table-responsive")
							- var animatetable=" animated fadeIn"           
							table(id="rankTblreqshares" class="table rankTbl"+animatetable)
								thead
									tr(class="you info-best" style="font-weight: bold")
										th(style="display:none")!="pos"
										th(class="wrapped")!= i18n.__("shares.table.reagent")
										th(class="desktabonly")= i18n.__("shares.table.vendor")
										th(class="deskfullonly")= i18n.__("shares.table.catalog")
										th(class="")= i18n.__("shares.table.requestor")
										th= i18n.__("shares.table.date")
										th(data-toggle="tooltip", title=i18n.__("admins.table.header.cancelorder"))= i18n.__("shares.table.delete")
								tbody
									-var ob = mysharesrequest
									-for(var prop in ob)
										- var canc = i18n.__("admins.table.x") + ob[prop].agent
										- var n = ob[prop].status
										- var d = new Date(ob[prop].date)
										- d = d.toLocaleDateString("en-US")
										- var isnew = ""
										- var checkedstr = false
										- if(n != "fulfilled")
											- isnew = "isnew"
										- var insuff = parseInt(ob[prop].insufficient)
										- if(insuff == 0)
											- isnew = "backColorinsuff"
											- checkedstr = true
											- canc = i18n.__("admins.table.repl") + ob[prop].agent
										- var lab = (ob[prop].lab).replace(" ","").toLowerCase();
										- var c = "cancel" + prop
										- var status = ob[prop].status
										- var showcancel = ""
										- if(status == 'fulfilled')
											- showcancel = "display:none;"
										
										tr(class=isnew, data-pos=prop)
											td(style="display:none") #{prop}
											td(class="wrapped2") #{ob[prop].agent}
											td(class="wrapped2 desktabonly") #{ob[prop].vendor}
											td(class="wrapped2 deskfullonly") #{ob[prop].catalognumber}
											td(class="wrapped2") #{ob[prop].requestoremail}
											td #{d}
											td(style="width: 17px;display:block;padding-left: 0px;padding-right: 0px;", title=canc)
												form(action="/cancelshare" method="post")
													div(class="checkboxThree1", style=showcancel)
														input(style="position:absolute;left: -9999px;" type="checkbox" id=c name="cancel" value="cancel" class="cancel" checked=(checkedstr===true ? "checked" : undefined))
														label(class="labelcheck1 shadow" for=c)
													input(type="hidden" class="agentid" name="agent" value=ob[prop].agent)
													input(type="hidden" class="labid" name="lab" value=ob[prop].lab)
													input(type="hidden" class="vendorid" name="vendor" value=ob[prop].vendor)
													input(type="hidden"  class="catalogid" name="catalognumber" value=ob[prop].catalognumber)
													input(type="hidden" class="owneremailid" name="email" value=ob[prop].email)
													input(type="hidden" class="requestorid" name="requestoremail" value=ob[prop].requestoremail)
													input(type="hidden" class="selfid" name="self" value="self")
													input(type="hidden" name="date" value=ob[prop].date)
													input(type="hidden" name="table" value=currentlabname.replace(" ","").toLowerCase() + "_orders")
													input(type="hidden" name="pos" value=prop)
				div(class="threepointssep")
			if(myshares != "")
				h4(style="padding-top: 25px;")= i18n.__("shares.none.title")
				p!= i18n.__("shares.none.subtitle")
				div(id="results2", class="resultsshadow")
					div(id="ctl00_Div2" class="row rank")
						div(class="table-responsive")
							- var animatetable2=" animated fadeIn"              
							table(id="rankTblshares" class="table rankTbl"+animatetable2)
								thead
									tr(class="you info-best" style="font-weight: bold")
										th(style="display:none")!="pos"
										th(class="wrapped")!= i18n.__("shares.table.reagent")
										th= i18n.__("shares.table.vendor")
										th= i18n.__("shares.table.catalog")
										th(data-toggle="tooltip",title=i18n.__("admins.table.header.insuff"))= i18n.__("shares.table.delete")
								tbody
									-var ob = myshares
									-for(var prop in ob)
										- var currentqtyint = parseInt(ob[prop].currentquantity)
										- var qtyinsufficient = ""
										- var checkedstr = false
										- var insuff = parseInt(ob[prop].insufficient)
										- var canc = ob[prop].agent + i18n.__("admins.table.insuff")
										- if(insuff == 0)
											- qtyinsufficient = "backColorinsuff"
											- checkedstr = true
											- canc = ob[prop].agent + i18n.__("admins.table.repl")
										- var c = "cancelr" + prop
										
										tr(class=qtyinsufficient, data-pos=prop)
											td(style="display:none") #{prop}
											td(class="wrapped2") #{ob[prop].agent}
											td(class="wrapped2") #{ob[prop].vendor}
											td(class="wrapped2") #{ob[prop].catalognumber}
											td(style="width: 17px;display:block;padding-left: 0px;padding-right: 0px;", title=canc)
												form(action="/cancelshare" method="post")
													div(class="checkboxThree1")
														input(style="position:absolute;left: -9999px;" type="checkbox" id=c name="cancel" value="cancel" class="cancel" checked=(checkedstr===true ? "checked" : undefined))
														label(class="labelcheck1 shadow" for=c)
													input(type="hidden" class="agentid" name="agent" value=ob[prop].agent)
													input(type="hidden" class="labid" name="lab" value=ob[prop].lab)
													input(type="hidden" class="vendorid" name="vendor" value=ob[prop].vendor)
													input(type="hidden" class="catalogid" name="catalognumber" value=ob[prop].catalognumber)
													input(type="hidden" class="owneremailid" name="email" value=ob[prop].email)
													input(type="hidden" name="date" value=ob[prop].date)
													input(type="hidden" name="table" value="vm2016_agentsshare")
													input(type="hidden" name="pos2" value=prop)
		div(style="float:right;", class="share-container " + adjust + " adjustpaddingrightandwidth " + fadesections)
			div(class="threepointssep mobileonly3" style="margin-bottom:5px")
			script(type="text/javascript" src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js")

			h3(style="padding-top:43px")
				span(class="fa fa-bar-chart" style=" color: #337ab7; margin-right: 10px;")
				span= i18n.__("shares.chart.title")
			form(action="chartSelect", method="post")
				div(class="buttons")
					select(name="chartSelect" type="text" id="chartSelect" class="form-control" style="width: 97%;border-color:#3d9dcb;margin-bottom:10px;z-index: 1;background-color: transparent;" placeholder=i18n.__("shares.chart.select"))
						option(value="chartNone",style="font-weight:bold")=i18n.__("shares.chart.option1")
						option(value="chartVenn" selected)= i18n.__("shares.chart.option2")
						option(value="chartAll")= i18n.__("shares.chart.option3")
						option(value="chartMonth")= i18n.__("shares.chart.option4")
					span(class="fa fa-sort" style="color: #8a6d3b; float: right; top: -35px; left: -35px; position: relative; font-size: 14pt;z-index:-1")
			div(id="chartNotes", style="display:none")
				p!= i18n.__("shares.chart.notes")
			- var find0 = filteroutput2
			- var now = new Date()
			- var filteroutput = test.filter(function(x){console.log("x.monthorder: "+x.monthorder); console.log("x.yearorder: "+x.yearorder); console.log("now.getFullYear(): "+ now.getFullYear()); console.log("now.getMonth(): "+ now.getMonth()); console.log("so: "+ (x.yearorder == now.getFullYear() && x.monthorder == now.getMonth())); return (x.yearorder == now.getFullYear() && x.monthorder == now.getMonth() + 1)});

			div(style="margin-bottom: 30px; margin-top: 0px;")
			div(id="sharesVenn", style="display:none")
				h4= i18n.__("shares.venn.title")
				- if(report_venn != null && report_venn.length > 0)
					p!=i18n.__("shares.venn.subtitle1")
						span
							img(src='/images/venn.png' width='16px' height='16px')
						span= i18n.__("shares.venn.subtitle2")

					div= i18n.__("shares.venn.desc")
						input(id="search-field" type="search" style="margin-top:8px; margin-left:10px; font-size: 14px;padding: 4px 10px;line-height: 1.42857143; border: 1px solid #ccc; border-radius: 4px;" placeholder=i18n.__("shares.venn.select"))
						span(id="search-status" class="label label-info" style="vertical-align: 10px; margin-left: 0px;" class="label label-success")
					div(class="ct-chart5 ct-perfect-five", style="overflow:auto;")
						div(id="vennChart" style="margin: 0 auto; /*width: 430px; height: 300px*/")
						- var array_labs_venn = " |"
						- var array_catalogs_venn = " |"
						- var ob = report_venn
						- var venn = []
						- var getlabs = []
						- var labname = ""
						- var seriesname = ""
						- var seriesdata = []
						- var vennportion = {name:'', data:[]}
						- for(var prop in ob)
							- getlabs.push(ob[prop].labname)
						- for(var prop in ob)
							- if(seriesname == '')
								- seriesname = ob[prop].labname
							- if(labname == '')
								- labname = ob[prop].labname
							- if (ob[prop].labname == labname && prop < (ob.length))
								- seriesname = ob[prop].labname
								- seriesdata.push(ob[prop].catalognumber)
								- if(prop == (ob.length - 1))
									- vennportion = {name:'', data:[]}
									- vennportion.name = seriesname
									- vennportion.data = seriesdata
									- venn.push(vennportion)
							- else
								- vennportion.name = seriesname
								- vennportion.data = seriesdata
								- venn.push(vennportion)
								- seriesdata = []
								- seriesname = ob[prop].labname
								- seriesdata.push(ob[prop].catalognumber)
								- labname = ob[prop].labname
								- vennportion = {name:'', data:[]}
							- array_labs_venn = array_labs_venn + ob[prop].labname + "|"
							- array_catalogs_venn = array_catalogs_venn + ob[prop].catalognumber + "|"

						script.
							var test = JSON.parse('#{JSON.stringify(venn)}'.replace(/&quot;/g, '"'));
							var colorDefault = ["rgb(61,157,203)", "rgb(138,109,59)", "rgb(0,102,0)", "rgb(90,155,212)", "rgb(241,90,96)", "rgb(207,207,27)", "rgb(255,117,0)", "rgb(192,152,83)"];
							console.log(test);
							console.log("filter department venn: " + "#{array_labs_venn}");
							console.log("filter catalog venn: " + "#{array_catalogs_venn}");
							console.log("filter venn: " + "#{venn}");
							var var_venn_chart_title1 = "#{i18n.__("shares.venn.chart.title1")}", var_venn_chart_title2 = "#{i18n.__("shares.venn.chart.title2")}", var_venn_chart_titlenone = "#{i18n.__("shares.venn.chart.titlenone")}";
						script(type="text/javascript" src="/js/shares-venn-utils.js")


					div(style="margin-left: 20%;")
						div(id="tooltipsvenn-container")
							div(id="tooltipsvenn", class="labColor", style="margin-top:-15px")!= i18n.__("shares.venn.chart.table")
							div
								ul(id="pagination-demo" class="pagination-sm")
				- if(report_venn != null && report_venn.length==0)
					h5=i18n.__("shares.venn.none")
					p(style="padding-top: 20px;")=" "
			div(id="sharesAll", style="display:none")
				h4= i18n.__("shares.all.title")
				- if(filteroutput2 != null && filteroutput2.length > 0)
					p!=i18n.__("shares.all.subtitle")
					div(class="ct-chart ct-perfect-fourth")
					div(id="tooltips", class="labColor") &nbsp;
				- if(filteroutput2 != null && filteroutput2.length==0)
					h5= i18n.__("shares.all.none")
					p(style="padding-top: 20px;")=" "
			div(id="monthAll", style="display:none")
				h4= i18n.__("shares.month.title")
				- var month = "month";
				- //var filteroutput = test.filter(function(x){console.log("x.monthorder: "+x.monthorder); console.log("x.yearorder: "+x.yearorder); console.log("now.getFullYear(): "+ now.getFullYear()); console.log("now.getMonth(): "+ now.getMonth()); console.log("so: "+ (x.yearorder == now.getFullYear() && x.monthorder == now.getMonth())); return (x.yearorder == now.getFullYear() && x.monthorder == now.getMonth() + 1)});
				- if(filteroutput != null && filteroutput.length > 0) 
					p!=i18n.__("shares.month.subtitle1") + month + i18n.__("shares.month.subtitle2")
					div(class="ct-chart0 ct-perfect-fourth")
					div(id="tooltips0", class="labColor") &nbsp;
				- if(filteroutput != null && filteroutput.length == 0) 
					h5
						span!=i18n.__("shares.month.none")
			div(style="padding-top:25px;", class="") &nbsp;
			- var array_rows = " |"
			- var array_values = "0|"
			- var array_rows2 = []
			- var array_values2 = ""
			- if(filteroutput2 != null && filteroutput2.length > 0) 
				-var ob = filteroutput2
				-for(var prop in ob)
					- array_rows = array_rows + ob[prop].agent + "|"
					- array_values = array_values + ob[prop].count + "|"
				-var ob2 = filteroutput
				-for(var prop in ob2)
					- array_rows2 = array_rows2 + ob2[prop].agent + "|"
					- array_values2 = array_values2 + ob2[prop].counting + "|"

				script.
					var var_filteroutput = "#{filteroutput}", var_array_values = "#{array_values}", var_array_rows = "#{array_rows}", var_array_values2 = "#{array_values2}", var_dot_select = "#{i18n.__("dot.selected")}";
				script(type="text/javascript" src="/js/shares-chartnotes-utils.js")
			div(class="slide-out-tip-div desktabonly", style="display:none;z-index:1;position: fixed;top: 25% !important;max-height:380px;")
				a(class="handle" href="", title='#{i18n.__("search.tip.title")}', style="right: -60px;,left:-60px;top:25px;")!=Content
				div(style="padding: 1px;color:white;top: -45px;position: relative;max-height: 320px;overflow: auto;")
					div(style="text-align: center;")
						span(class="zoom_controls")
							a(href="#" class="zoom_out zoomicon" title=i18n.__("zoom.minus"))
								span(class="fa fa-minus-circle")
							a(href="#" class="zoom_reset zoomicon" title=i18n.__("zoom.reset"))
								span(class="fa fa-circle-o-notch")
							a(href="#" class="zoom_in zoomicon" title=i18n.__("zoom.plus"))
								span(class="fa fa-plus-circle")
						div(class="threepointssep", style="margin-top: -10px;")
					p(style="font-size: 12pt;")!= i18n.__("shares.tip.header")
					div(style="position: relative;float: right;width: 250px;font-size: 9pt;line-height: 1.3;border-radius: 4px;")
						span!= i18n.__("shares.tip.desc")
		span(class="desktabonly", id="checkdisplay")
